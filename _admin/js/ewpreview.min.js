/**
 * Detail Preview Extension
 * @license (C)2014 e.World Technology Ltd.
 */
function ew_AddRowToTable(e){var t,a,o=jQuery,i=o(e),n=0,r=i.closest("tbody");EW_PREVIEW_SINGLE_ROW&&r.find("tr."+EW_TABLE_PREVIEW_ROW_CLASSNAME).remove(),o(e.cells).each(function(){n+=this.colSpan});var d=i.next("tr[data-rowindex!="+i.data("rowindex")+"]");return d.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)?sr:((t=r[0].insertRow(d[0]?d[0].sectionRowIndex:-1))&&(o(t).addClass(EW_TABLE_PREVIEW_ROW_CLASSNAME),a=o(t.insertCell(0)).addClass(EW_TABLE_LAST_COL_CLASSNAME).prop("colSpan",n)),t)}function ew_ShowDetails(){var e=jQuery,t=e(this),a=t.is("tr[data-rowindex]"),o=a?t:t.closest("tr[data-rowindex]"),i=o.closest("table");if(o[0]){if(o.data("preview")){var n=o.next("tr[data-rowindex!='"+o.data("rowindex")+"']");n.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)&&n.remove(),o.data("preview",!1).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-expand").removeClass("icon-collapse")}else{var r=ew_AddRowToTable(o[0]),d=e(r.cells[0]),s=o.find("[class$=_preview] div.ewPreview");d.empty(),d.append(e("#ewPreview").contents().clone()).find(".nav-tabs").append(s.find("li:has([data-toggle='tab'])").clone(!0)).find("[data-toggle='tab']").attr("data-target","#"+d.find(".tab-pane").attr("id",ew_Random()).attr("id")).first().tab("show"),(EW_PREVIEW_SINGLE_ROW?i:o).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-expand").removeClass("icon-collapse"),o.data("preview",!0).find(EW_PREVIEW_BUTTON_SELECTOR).addClass("icon-collapse").removeClass("icon-expand")}ew_SetupTable(-1,i[0],!0)}}function ew_Detail(e,t){var a=jQuery,o=a(t),i=o.closest(".ewListOptionBody"),n=o.data("placement")||EW_PREVIEW_PLACEMENT,r=i.find(".dropdown-menu"),d=i.find(".btn-group");r.mouseenter(function(e){e.stopPropagation()}),d[0]&&("right"==n&&r.addClass("pull-right"),o=d),o.data("bs.popover")||o.popover({html:!0,delay:{show:100,hide:250},placement:n,trigger:"hover",container:a("#ewTooltip")[0],content:EW_PREVIEW_LOADING_HTML}).on("show.bs.popover",function(){a(".popover.ewPreviewOverlay").hide(),o.data("bs.popover").tip().css("opacity",0)}).on("shown.bs.popover",function(){var e=o.data("bs.popover").tip().css({"min-width":"200px","max-width":"1000px"});e.find(".popover-content").html(a("#ewPreview").html()),e.find(".nav-tabs").append(i.find("li:has([data-toggle='tab'])").clone(!0)),e.find("[data-toggle='tab']").attr("data-target","#"+e.find(".tab-pane").attr("id",ew_Random()).attr("id")).data("$element",o).first().tab("show"),ew_MoveTip(o),e.fadeTo(0,1).addClass("ewPreviewOverlay")}).data("bs.popover").tip().mouseenter(function(){clearTimeout(o.data("bs.popover").timeout)}).mouseleave(function(){var e=o.data("bs.popover");e.tip().html().indexOf(EW_PREVIEW_LOADING_HTML)>-1||(e.timeout=setTimeout(function(){e.hide.call(e)},e.options.delay.hide))})}function ew_MoveTip(e){var t=jQuery,a=e.data("placement")||EW_PREVIEW_PLACEMENT;if("left"==a||"right"==a){var o=t(document),i=t(document.body),n=e.data("bs.popover").tip(),r=(n.width(),n.position()),d=e.parent();bottom=o.scrollTop()+i.outerHeight()-n.outerHeight(),d.hasClass("btn-group")&&(e=d,d=e.parent());var s=e.position();r.top=s.top+e.height()/2-n.height()/2,r.top=Math.max(o.scrollTop(),Math.min(bottom,r.top)),n.css("top",r.top+"px"),"right"==a&&e.is(".btn-group")&&n.css("left",e.position().left+e.width());var p=n.find(".arrow");"left"==a&&(left=s.left-n.outerWidth()-p.width(),n.css("left",left));var l=s.top-r.top+e.height()/2-p.height(),E=(parseInt(n.css("border-top-left-radius"),10)||6)-parseInt(p.css("margin-top"),10),_=n.height()-E-p.height();p.css("top",Math.max(E,Math.min(l,_))+"px")}}function ew_TabShow(e){var t=jQuery,a=t(e.target),o=a.data("url"),i=a.data("table"),n=t(a.attr("data-target"));o&&n[0]&&(n.empty().html(EW_PREVIEW_LOADING_HTML),t.get(o,function(e){n.empty().html(e).append(t("div[data-table='"+i+"'][data-url='"+o+"']:first").clone()),t(document).trigger("preview",[{$tabpane:n}]),a.data("$element")&&ew_MoveTip(a.data("$element"))}))}function ew_Preview(e,t){var a=t.$tabpane;a.find("table."+EW_TABLE_CLASSNAME).each(ew_SetupTable),ew_InitIcons(),a.find("a.ewTooltipLink").each(ew_Tooltip),$(".ewLightbox").each(function(){var e=$(this);e.colorbox($.extend({rel:e.data("rel")},ewLightboxSettings))})}var EW_PREVIEW_LOADING_HTML="<div class='ewSpinner'><div></div></div> "+ewLanguage.Phrase("Loading"),EW_PREVIEW_BUTTON_SELECTOR=".ewPreviewRowBtn";jQuery(document).on("preview",ew_Preview),jQuery(function(e){EW_PREVIEW_OVERLAY&&e("div.ewPreview").each(function(){e(this).parent().find("[data-action='view'],[data-action='list']").each(ew_Detail)}),e(EW_PREVIEW_BUTTON_SELECTOR).click(ew_ShowDetails),e("div.ewPreview [data-toggle='tab']").on("show.bs.tab",ew_TabShow)});