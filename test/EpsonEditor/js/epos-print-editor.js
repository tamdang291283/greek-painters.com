/*! ePOS-Print Editor Version 1.6.0 Copyright (C) SEIKO EPSON CORPORATION 2012. All rights reserved. */
var tabindex=0;$(function(){var f=window.localStorage,e,a,b;if(f){e=f.getItem("model");if(e){a=e-0;b=$("#setting-model").get(0);if(!isNaN(a)&&a>=0&&a<b.length){b.selectedIndex=a}}e=f.getItem("width");if(e){$("#setting-width").val(e)}e=f.getItem("ipaddr");if(e){$("#setting-ipaddr").val(e)}e=f.getItem("devid");if(e){$("#setting-devid").val(e)}e=f.getItem("timeout");if(e){a=e-0;if(!isNaN(a)&&a>=0&&a<=300000){$("#setting-timeout").val(a)}}e=f.getItem("status");if(e){if(/^(1|true)$/.test(e)){$("#setting-status").attr("checked","checked")}else{if(/^(0|false)$/.test(e)){$("#setting-status").removeAttr("checked")}}}e=f.getItem("jobid");if(e){if(/^(1|true)$/.test(e)){$("#setting-jobid").attr("checked","checked")}else{if(/^(0|false)$/.test(e)){$("#setting-jobid").removeAttr("checked")}}}}$("#tabs").tabs({select:function(g,h){switch(tabindex){case 0:try{exportDoc()}catch(i){$("#edit-info").text(i.message);$("#edit-error").dialog("open");return false}break;case 5:try{exportDoc()}catch(i){}setStatusMonitor();break;default:break}switch(h.index){case 1:try{drawPreview()}catch(i){$("#edit-info").text(i.message);$("#edit-error").dialog("open");return false}break;case 2:setApiCode();break;case 3:setXmlDoc();break;case 4:setPrintDoc();break;default:break}tabindex=h.index},selected:tabindex});$("#edit-left").disableSelection().draggable({axis:"y",containment:"parent"});$("#edit-left li").hover(function(){$(this).addClass("ui-state-highlight")},function(){$(this).removeClass("ui-state-highlight")}).click(function(){var g=$(this).clone();$("#edit-sequence").append(g);extract(g)}).draggable({connectToSortable:"#edit-sequence",helper:"clone"});$("#edit-sequence").sortable({placeholder:"edit-holder",update:function(g,h){extract(h.item)}});$("#edit-clear").button().click(function(){$("#edit-confirm").dialog("open")});$("#edit-confirm").dialog({autoOpen:false,width:400,buttons:[{text:message.yes,click:function(){$(this).dialog("close");$("#edit-sequence li").remove();$("#edit-force").removeAttr("checked");$("#edit-left").css({top:0})}},{text:message.no,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#edit-import").button().click(function(){$("#import-doc, #import-info").val("");$("#import").dialog("open")});$("#import").dialog({autoOpen:false,width:600,buttons:[{text:message.close,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#import-apply").button().click(function(){$("#import-confirm").dialog("open")});$("#import-confirm").dialog({autoOpen:false,width:400,buttons:[{text:message.yes,click:function(){$(this).dialog("close");importDoc();$("#edit-left").css({top:0})}},{text:message.no,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#edit-error").dialog({autoOpen:false,width:600,buttons:[{text:message.ok,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#api-code, #xml-doc").click(function(){$(this).select()}).keydown(function(g){g.preventDefault()}).bind("paste",function(g){g.preventDefault()});$("#print-info, #import-info").change(function(){this.scrollTop=this.scrollHeight}).keydown(function(g){g.preventDefault()}).bind("paste",function(g){g.preventDefault()});$("#print-send").button().click(function(){sendPrintDoc()});$("#print-clear").button().click(function(){$("#print-info").val("")});$("#setting-model").change(function(){if(/^tm_(l90|p60_la)/.test($(this).val())){$(this).next().fadeIn();$("#setting-width").change()}else{$(this).next().fadeOut()}}).change();$("#setting-width").change(function(){var i=$(this).val()-0,g,h;if(/^tm_l90/.test($("#setting-model").val())){if(isNaN(i)||i>80){i=80}else{if(i<38){i=38}}$(this).val(i);h=Math.min(576,256+((i-38)<<3));g=modelinfo.tm_l90_re;g.width=h;g.page.ini_w=h;g.page.max_w=h;h=Math.min(560,224+((i-38)<<3));g=modelinfo.tm_l90_la;g.width=h;g.page.ini_w=h;g.page.max_w=h}else{if(isNaN(i)||i>60){i=60}else{if(i<29){i=29}}$(this).val(i);h=Math.min(400,152+((i-29)<<3));g=modelinfo.tm_p60_la;g.width=h;g.page.ini_w=h;g.page.max_w=h}}).change();epos.address="http://"+$("#setting-ipaddr").val()+"/cgi-bin/epos/service.cgi?devid="+$("#setting-devid").val()+"&timeout="+$("#setting-timeout").val();$("#setting-timeout").change(function(){var g=$(this).val()-0;if(isNaN(g)||g>300000){g=60000}else{if(g<1000){g=1000}}$(this).val(g)});$(window).bind("unload",function(g){var h=window.localStorage;if(h){h.setItem("model",$("#setting-model").get(0).selectedIndex);h.setItem("width",$("#setting-width").val());h.setItem("ipaddr",$("#setting-ipaddr").val());h.setItem("devid",$("#setting-devid").val());h.setItem("timeout",$("#setting-timeout").val());h.setItem("status",$("#setting-status").is(":checked"));h.setItem("jobid",$("#setting-jobid").is(":checked"))}});$(window).bind("beforeunload",function(g){return message.unload})});function extract(a){a.find("button").button({icons:{primary:"ui-icon-close"},text:false}).click(function(){a.fadeOut("fast",function(){$(this).remove()})});a.find(".attr-text-linespc, .attr-feed-unit, .attr-feed-line, .attr-sound-repeat").each(function(){slider($(this),0,255,1)});a.find(".attr-barcode-height").each(function(){slider($(this),1,255,1)});a.find(".attr-logo-key1, .attr-logo-key2").each(function(){slider($(this),32,126,1)});a.find(".attr-hline-x1, .attr-hline-x2, .attr-vline-x, .attr-area-x").each(function(){slider($(this),0,575,1)});a.find(".attr-area-width").each(function(){slider($(this),1,576,1)});a.find(".attr-text-x, .attr-text-y, .attr-area-y, .attr-position-x, .attr-position-y, .attr-line-x1, .attr-line-y1, .attr-line-x2, .attr-line-y2, .attr-rectangle-x1, .attr-rectangle-y1, .attr-rectangle-x2, .attr-rectangle-y2").each(function(){slider($(this),0,2399,1)});a.find(".attr-area-height").each(function(){slider($(this),1,2400,1)});a.find(".attr-text-width, .attr-text-height").each(function(){slider($(this),1,8,1)});a.find(".attr-image-brightness").each(function(){slider($(this),0.1,10,0.1)});a.find(".attr-barcode-width").each(function(){slider($(this),2,6,1)});a.find(".attr-symbol-width").each(function(){slider($(this),0,16,1)});a.find(".attr-symbol-height").each(function(){slider($(this),0,8,1)});a.find(".attr-symbol-size").each(function(){slider($(this),0,2400,1)});a.find(".attr-symbol-level").each(function(){slider($(this),5,95,1)});a.find(".attr-sound-cycle").each(function(){slider($(this),1000,25500,100)});a.find(".attr-layout-width").each(function(){slider($(this),29,80,0.1)});a.find(".attr-layout-height").each(function(){slider($(this),28.4,310,0.1)});a.find(".attr-layout-margin-top").each(function(){slider($(this),-15,300,0.1)});a.find(".attr-layout-margin-bottom").each(function(){slider($(this),-1.5,1.5,0.1)});a.find(".attr-layout-offset-cut").each(function(){slider($(this),-29,5,0.1)});a.find(".attr-layout-offset-label").each(function(){slider($(this),0,1.5,0.1)});a.find(".tooltip-text").hover(function(){a.find(".tooltip:not(:animated)").fadeIn()},function(){a.find(".tooltip").fadeOut()});a.find(".attr-image-load").click(function(){var b=$(this).nextAll(".attr-image").get(0);b.src=$(this).prevAll(".attr-image-file").val()+"?"+new Date().getTime()});a.find(":text").click(function(){$(this).focus()}).keypress(function(b){if(b.which==13){b.preventDefault()}});a.find(".attr-text-data").css("font","medium "+font);a.find(".attr-layout-height-auto").attr("name",new Date().getTime());a.removeClass("ui-state-highlight");a.find(".edit-caption").css("float","left");a.find("div").show()}function slider(f,b,a,e){f.change(function(){var g=f.val()-0;if(isNaN(g)||g<b){g=b}else{if(g>a){g=a}}f.val(g);$(this).next().slider("value",g)}).next().slider({min:b,max:a,value:f.val()-0,step:e,slide:function(g,h){f.val(h.value)}})}var import_convert={font_font_a:"FONT_A",font_font_b:"FONT_B",font_font_c:"FONT_C",font_font_d:"FONT_D",font_font_e:"FONT_E",font_special_a:"FONT_SPECIAL_A",font_special_b:"FONT_SPECIAL_B",align_left:"ALIGN_LEFT",align_center:"ALIGN_CENTER",align_right:"ALIGN_RIGHT",color_none:"COLOR_NONE",color_color_1:"COLOR_1",color_color_2:"COLOR_2",color_color_3:"COLOR_3",color_color_4:"COLOR_4",feed_peeling:"FEED_PEELING",feed_cutting:"FEED_CUTTING",feed_current_tof:"FEED_CURRENT_TOF",feed_next_tof:"FEED_NEXT_TOF",mode_mono:"MODE_MONO",mode_gray16:"MODE_GRAY16",barcode_upc_a:"BARCODE_UPC_A",barcode_upc_e:"BARCODE_UPC_E",barcode_ean13:"BARCODE_EAN13",barcode_jan13:"BARCODE_JAN13",barcode_ean8:"BARCODE_EAN8",barcode_jan8:"BARCODE_JAN8",barcode_code39:"BARCODE_CODE39",barcode_itf:"BARCODE_ITF",barcode_codabar:"BARCODE_CODABAR",barcode_code93:"BARCODE_CODE93",barcode_code128:"BARCODE_CODE128",barcode_gs1_128:"BARCODE_GS1_128",barcode_gs1_databar_omnidirectional:"BARCODE_GS1_DATABAR_OMNIDIRECTIONAL",barcode_gs1_databar_truncated:"BARCODE_GS1_DATABAR_TRUNCATED",barcode_gs1_databar_limited:"BARCODE_GS1_DATABAR_LIMITED",barcode_gs1_databar_expanded:"BARCODE_GS1_DATABAR_EXPANDED",hri_none:"HRI_NONE",hri_above:"HRI_ABOVE",hri_below:"HRI_BELOW",hri_both:"HRI_BOTH",symbol_pdf417_standard:"SYMBOL_PDF417_STANDARD",symbol_pdf417_truncated:"SYMBOL_PDF417_TRUNCATED",symbol_qrcode_model_1:"SYMBOL_QRCODE_MODEL_1",symbol_qrcode_model_2:"SYMBOL_QRCODE_MODEL_2",symbol_qrcode_micro:"SYMBOL_QRCODE_MICRO",symbol_maxicode_mode_2:"SYMBOL_MAXICODE_MODE_2",symbol_maxicode_mode_3:"SYMBOL_MAXICODE_MODE_3",symbol_maxicode_mode_4:"SYMBOL_MAXICODE_MODE_4",symbol_maxicode_mode_5:"SYMBOL_MAXICODE_MODE_5",symbol_maxicode_mode_6:"SYMBOL_MAXICODE_MODE_6",symbol_gs1_databar_stacked:"SYMBOL_GS1_DATABAR_STACKED",symbol_gs1_databar_stacked_omnidirectional:"SYMBOL_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",symbol_gs1_databar_expanded_stacked:"SYMBOL_GS1_DATABAR_EXPANDED_STACKED",symbol_azteccode_fullrange:"SYMBOL_AZTECCODE_FULLRANGE",symbol_azteccode_compact:"SYMBOL_AZTECCODE_COMPACT",symbol_datamatrix_square:"SYMBOL_DATAMATRIX_SQUARE",symbol_datamatrix_rectangle_8:"SYMBOL_DATAMATRIX_RECTANGLE_8",symbol_datamatrix_rectangle_12:"SYMBOL_DATAMATRIX_RECTANGLE_12",symbol_datamatrix_rectangle_16:"SYMBOL_DATAMATRIX_RECTANGLE_16",level_level_0:"LEVEL_0",level_level_1:"LEVEL_1",level_level_2:"LEVEL_2",level_level_3:"LEVEL_3",level_level_4:"LEVEL_4",level_level_5:"LEVEL_5",level_level_6:"LEVEL_6",level_level_7:"LEVEL_7",level_level_8:"LEVEL_8",level_level_l:"LEVEL_L",level_level_m:"LEVEL_M",level_level_q:"LEVEL_Q",level_level_h:"LEVEL_H",level_default:"LEVEL_DEFAULT",line_thin:"LINE_THIN",line_medium:"LINE_MEDIUM",line_thick:"LINE_THICK",line_thin_double:"LINE_THIN_DOUBLE",line_medium_double:"LINE_MEDIUM_DOUBLE",line_thick_double:"LINE_THICK_DOUBLE",direction_left_to_right:"DIRECTION_LEFT_TO_RIGHT",direction_bottom_to_top:"DIRECTION_BOTTOM_TO_TOP",direction_right_to_left:"DIRECTION_RIGHT_TO_LEFT",direction_top_to_bottom:"DIRECTION_TOP_TO_BOTTOM",cut_no_feed:"CUT_NO_FEED",cut_feed:"CUT_FEED",cut_reserve:"CUT_RESERVE",drawer_drawer_1:"DRAWER_1",drawer_drawer_2:"DRAWER_2",pulse_pulse_100:"PULSE_100",pulse_pulse_200:"PULSE_200",pulse_pulse_300:"PULSE_300",pulse_pulse_400:"PULSE_400",pulse_pulse_500:"PULSE_500",pattern_none:"PATTERN_NONE",pattern_pattern_1:"PATTERN_1",pattern_pattern_2:"PATTERN_2",pattern_pattern_3:"PATTERN_3",pattern_pattern_4:"PATTERN_4",pattern_pattern_5:"PATTERN_5",pattern_pattern_6:"PATTERN_6",pattern_pattern_7:"PATTERN_7",pattern_pattern_8:"PATTERN_8",pattern_pattern_9:"PATTERN_9",pattern_pattern_10:"PATTERN_10",pattern_pattern_a:"PATTERN_A",pattern_pattern_b:"PATTERN_B",pattern_pattern_c:"PATTERN_C",pattern_pattern_d:"PATTERN_D",pattern_pattern_e:"PATTERN_E",pattern_error:"PATTERN_ERROR",pattern_paper_end:"PATTERN_PAPER_END",layout_receipt:"LAYOUT_RECEIPT",layout_receipt_bm:"LAYOUT_RECEIPT_BM",layout_label:"LAYOUT_LABEL",layout_label_bm:"LAYOUT_LABEL_BM",lang_ja:"ja","lang_ja-jp":"ja",lang_ko:"ko","lang_ko-kr":"ko","lang_zh-cn":"zh-cn","lang_zh-hans":"zh-hans","lang_zh-tw":"zh-tw","lang_zh-hant":"zh-hant"};function importDoc(){var h=new Array(),a=1,m=1,k=false,j=false,b=false,g="COLOR_1",l,f;try{l=$($.parseXML($("#import-doc").val()));if(l.find("epos-print").size()==0){throw new Error(message.import_noelem)}$("#edit-sequence li").remove();$("#edit-force").removeAttr("checked");if(/^(1|true)$/.test(l.find("epos-print").attr("force"))){$("#edit-force").attr("checked","checked")}l.find("epos-print > page-end").remove();l.find("epos-print > page").after($("<page-end/>"));f=l.find("epos-print > *, epos-print > page > *");f.each(function(r,o){var q=$(this),u=$("#edit-left ul"),w=false,v,s,e,n,t;switch(o.tagName){case"text":if(q.is("[align]")){v=u.find(".epos-text-align").clone();e=q.attr("align");s=import_convert["align_"+e];if(s){v.find(".attr-text-align").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'align="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}if(q.is("[linespc]")){v=u.find(".epos-text-linespc").clone();e=q.attr("linespc");s=e|0;if(isNaN(s)||s<0||s>255){h.push("<"+o.tagName+">"+message.import_inattr+'linespc="'+e+'"');break}v.find(".attr-text-linespc").val(s);$("#edit-sequence").append(v);extract(v)}if(q.is("[rotate]")){v=u.find(".epos-text-rotate").clone();e=q.attr("rotate");if(/^(1|true)$/.test(e)){v.find(".attr-text-rotate").attr("checked","checked")}else{if(/^(0|false)$/.test(e)){v.find(".attr-text-rotate").removeAttr("checked")}else{h.push("<"+o.tagName+">"+message.import_inattr+'rotate="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}if(q.is("[lang]")){v=u.find(".epos-text-lang").clone();s=import_convert[("lang_"+q.attr("lang")).toLowerCase()];v.find(".attr-text-lang").val(s?s:"en");$("#edit-sequence").append(v);extract(v)}if(q.is("[font]")){v=u.find(".epos-text-font").clone();e=q.attr("font");s=import_convert["font_"+e];if(s){v.find(".attr-text-font").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'font="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}if(q.is("[x]")){v=u.find(".epos-text-position").clone();e=q.attr("x");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'x="'+e+'"');break}v.find(".attr-text-x").val(s);$("#edit-sequence").append(v);extract(v)}if(q.is("[y]")){v=u.find(".epos-text-vposition").clone();e=q.attr("y");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y="'+e+'"');break}v.find(".attr-text-y").val(s);$("#edit-sequence").append(v);extract(v)}if(q.is("[smooth]")){v=u.find(".epos-text-smooth").clone();e=q.attr("smooth");if(/^(1|true)$/.test(e)){v.find(".attr-text-smooth").attr("checked","checked")}else{if(/^(0|false)$/.test(e)){v.find(".attr-text-smooth").removeAttr("checked")}else{h.push("<"+o.tagName+">"+message.import_inattr+'smooth="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}if(q.is("[dw], [dh]")){v=u.find(".epos-text-double").clone();e=q.attr("dw");if(e){if(/^(1|true)$/.test(e)){a=2}else{if(/^(0|false)$/.test(e)){a=1}else{h.push("<"+o.tagName+">"+message.import_inattr+'dw="'+e+'"');break}}}e=q.attr("dh");if(e){if(/^(1|true)$/.test(e)){m=2}else{if(/^(0|false)$/.test(e)){m=1}else{h.push("<"+o.tagName+">"+message.import_inattr+'dh="'+e+'"');break}}}if(a==2){v.find(".attr-text-dw").attr("checked","checked")}else{v.find(".attr-text-dw").removeAttr("checked")}if(m==2){v.find(".attr-text-dh").attr("checked","checked")}else{v.find(".attr-text-dh").removeAttr("checked")}$("#edit-sequence").append(v);extract(v);w=a>2||m>2}if(w||q.is("[width], [height]")){v=u.find(".epos-text-size").clone();e=q.attr("width");if(e){s=e|0;if(isNaN(s)||s<1||s>8){h.push("<"+o.tagName+">"+message.import_inattr+'width="'+e+'"');break}a=s}e=q.attr("height");if(e){s=e|0;if(isNaN(s)||s<1||s>8){h.push("<"+o.tagName+">"+message.import_inattr+'height="'+e+'"');break}m=s}v.find(".attr-text-width").val(a);v.find(".attr-text-height").val(m);$("#edit-sequence").append(v);extract(v);w=false}if(q.is("[reverse], [ul], [em], [color]")){v=u.find(".epos-text-style").clone();e=q.attr("reverse");if(e){if(/^(1|true)$/.test(e)){k=true}else{if(/^(0|false)$/.test(e)){k=false}else{h.push("<"+o.tagName+">"+message.import_inattr+'reverse="'+e+'"');break}}}e=q.attr("ul");if(e){if(/^(1|true)$/.test(e)){j=true}else{if(/^(0|false)$/.test(e)){j=false}else{h.push("<"+o.tagName+">"+message.import_inattr+'ul="'+e+'"');break}}}e=q.attr("em");if(e){if(/^(1|true)$/.test(e)){b=true}else{if(/^(0|false)$/.test(e)){b=false}else{h.push("<"+o.tagName+">"+message.import_inattr+'em="'+e+'"');break}}}e=q.attr("color");if(e){s=import_convert["color_"+e];if(s){g=s}else{h.push("<"+o.tagName+">"+message.import_inattr+'color="'+e+'"');break}}if(k){v.find(".attr-text-reverse").attr("checked","checked")}else{v.find(".attr-text-reverse").removeAttr("checked")}if(j){v.find(".attr-text-ul").attr("checked","checked")}else{v.find(".attr-text-ul").removeAttr("checked")}if(b){v.find(".attr-text-em").attr("checked","checked")}else{v.find(".attr-text-em").removeAttr("checked")}v.find(".attr-text-color").val(g);$("#edit-sequence").append(v);extract(v)}if(q.text().length>0){v=u.find(".epos-text").clone();v.find(".attr-text-data").val(escapeCode(q.text()));$("#edit-sequence").append(v);extract(v)}break;case"feed":if(q.is("[linespc]")){v=u.find(".epos-text-linespc").clone();e=q.attr("linespc");s=e|0;if(isNaN(s)||s<0||s>255){h.push("<"+o.tagName+">"+message.import_inattr+'linespc="'+e+'"');break}v.find(".attr-text-linespc").val(s);$("#edit-sequence").append(v);extract(v)}if(q.is("[unit]")){v=u.find(".epos-feed-unit").clone();e=q.attr("unit");s=e|0;if(isNaN(s)||s<0||s>255){h.push("<"+o.tagName+">"+message.import_inattr+'unit="'+e+'"');break}v.find(".attr-feed-unit").val(s);$("#edit-sequence").append(v);extract(v)}if(q.is("[line]")){v=u.find(".epos-feed-line").clone();e=q.attr("line");s=e|0;if(isNaN(s)||s<0||s>255){h.push("<"+o.tagName+">"+message.import_inattr+'line="'+e+'"');break}v.find(".attr-feed-line").val(s);$("#edit-sequence").append(v);extract(v)}if(q.is(":not([unit], [line], [pos])")){v=u.find(".epos-feed").clone();$("#edit-sequence").append(v);extract(v)}if(q.is("[pos]")){v=u.find(".epos-feed-pos").clone();e=q.attr("pos");s=import_convert["feed_"+e];if(s){v.find(".attr-feed-pos").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'pos="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}break;case"image":if(q.is("[align]")){v=u.find(".epos-text-align").clone();e=q.attr("align");s=import_convert["align_"+e];if(s){v.find(".attr-text-align").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'align="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}if(q.is("[width][height]")){v=u.find(".epos-image").clone();e=q.attr("mode");if(e){s=import_convert["mode_"+e];if(s){v.find(".attr-image-mode").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'mode="'+e+'"');break}}e=q.attr("color");if(e){s=import_convert["color_"+e];if(s){v.find(".attr-image-color").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'color="'+e+'"');break}}n=$("#epos-image").get(0);e=q.attr("width");s=e|0;if(isNaN(s)||s<1){h.push("<"+o.tagName+">"+message.import_inattr+'width="'+e+'"');break}n.width=s;e=q.attr("height");s=e|0;if(isNaN(s)||s<1){h.push("<"+o.tagName+">"+message.import_inattr+'height="'+e+'"');break}n.height=s;t=decodeBase64(q.text());if(q.attr("mode")=="gray16"){if(t.length==((n.width+1)>>1)*n.height){drawGray16(n,t)}else{h.push("<"+o.tagName+">"+message.import_intext);break}}else{if(t.length==((n.width+7)>>3)*n.height){drawMono(n,t)}else{h.push("<"+o.tagName+">"+message.import_intext);break}}v.find(".attr-image").attr({src:n.toDataURL()});v.find(".attr-image-file").val("");$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"width", "height"')}break;case"logo":if(q.is("[align]")){v=u.find(".epos-text-align").clone();e=q.attr("align");s=import_convert["align_"+e];if(s){v.find(".attr-text-align").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'align="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}if(q.is("[key1][key2]")){v=u.find(".epos-logo").clone();e=q.attr("key1");s=e|0;if(isNaN(s)||s<32||s>126){h.push("<"+o.tagName+">"+message.import_inattr+'key1="'+e+'"');break}v.find(".attr-logo-key1").val(s);e=q.attr("key2");s=e|0;if(isNaN(s)||s<32||s>126){h.push("<"+o.tagName+">"+message.import_inattr+'key2="'+e+'"');break}v.find(".attr-logo-key2").val(s);$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"key1", "key2"')}break;case"barcode":if(q.is("[align]")){v=u.find(".epos-text-align").clone();e=q.attr("align");s=import_convert["align_"+e];if(s){v.find(".attr-text-align").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'align="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}if(q.is("[rotate]")){v=u.find(".epos-text-rotate").clone();e=q.attr("rotate");if(/^(1|true)$/.test(e)){v.find(".attr-text-rotate").attr("checked","checked")}else{if(/^(0|false)$/.test(e)){v.find(".attr-text-rotate").removeAttr("checked")}else{h.push("<"+o.tagName+">"+message.import_inattr+'rotate="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}if(q.is("[type]")){v=u.find(".epos-barcode").clone();e=q.attr("type");s=import_convert["barcode_"+e];if(s){v.find(".attr-barcode-type").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'type="'+e+'"');break}e=q.attr("hri");if(e){s=import_convert["hri_"+e];if(s){v.find(".attr-barcode-hri").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'hri="'+e+'"');break}}e=q.attr("font");if(e){s=import_convert["font_"+e];if(s){v.find(".attr-barcode-font").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'font="'+e+'"');break}}e=q.attr("width");if(e){s=e|0;if(isNaN(s)||s<2||s>6){h.push("<"+o.tagName+">"+message.import_inattr+'width="'+e+'"');break}v.find(".attr-barcode-width").val(s)}e=q.attr("height");if(e){s=e|0;if(isNaN(s)||s<1||s>255){h.push("<"+o.tagName+">"+message.import_inattr+'height="'+e+'"');break}v.find(".attr-barcode-height").val(s)}v.find(".attr-barcode-data").val(escapeCode(q.text()));$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"type"')}break;case"symbol":if(q.is("[align]")){v=u.find(".epos-text-align").clone();e=q.attr("align");s=import_convert["align_"+e];if(s){v.find(".attr-text-align").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'align="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}if(q.is("[rotate]")){v=u.find(".epos-text-rotate").clone();e=q.attr("rotate");if(/^(1|true)$/.test(e)){v.find(".attr-text-rotate").attr("checked","checked")}else{if(/^(0|false)$/.test(e)){v.find(".attr-text-rotate").removeAttr("checked")}else{h.push("<"+o.tagName+">"+message.import_inattr+'rotate="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}if(q.is("[type]")){v=u.find(".epos-symbol").clone();e=q.attr("type");s=import_convert["symbol_"+e];if(s){v.find(".attr-symbol-type").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'type="'+e+'"');break}e=q.attr("level");if(e){s=import_convert["level_"+e];if(s){v.find(".attr-symbol-level-enum").val(s)}else{s=e|0;if(isNaN(s)||s<5||s>95){h.push("<"+o.tagName+">"+message.import_inattr+'level="'+e+'"');break}v.find(".attr-symbol-level").val(s)}}e=q.attr("width");if(e){s=e|0;if(isNaN(s)||s<0||s>16){h.push("<"+o.tagName+">"+message.import_inattr+'width="'+e+'"');break}v.find(".attr-symbol-width").val(s)}e=q.attr("height");if(e){s=e|0;if(isNaN(s)||s<0||s>8){h.push("<"+o.tagName+">"+message.import_inattr+'height="'+e+'"');break}v.find(".attr-symbol-height").val(s)}e=q.attr("size");if(e){s=e|0;if(isNaN(s)||s<0||s>2400){h.push("<"+o.tagName+">"+message.import_inattr+'size="'+e+'"');break}v.find(".attr-symbol-size").val(s)}v.find(".attr-symbol-data").val(escapeCode(q.text()));$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"type"')}break;case"hline":if(q.is("[x1][x2]")){v=u.find(".epos-hline").clone();e=q.attr("x1");s=e|0;if(isNaN(s)||s<0||s>575){h.push("<"+o.tagName+">"+message.import_inattr+'x1="'+e+'"');break}v.find(".attr-hline-x1").val(s);e=q.attr("x2");s=e|0;if(isNaN(s)||s<0||s>575){h.push("<"+o.tagName+">"+message.import_inattr+'x2="'+e+'"');break}v.find(".attr-hline-x2").val(s);e=q.attr("style");if(e){s=import_convert["line_"+e];if(s){v.find(".attr-hline-style").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'style="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x1", "x2"')}break;case"vline-begin":if(q.is("[x]")){v=u.find(".epos-vline-begin").clone();e=q.attr("x");s=e|0;if(isNaN(s)||s<0||s>575){h.push("<"+o.tagName+">"+message.import_inattr+'x="'+e+'"');break}v.find(".attr-vline-x").val(s);e=q.attr("style");if(e){s=import_convert["line_"+e];if(s){v.find(".attr-vline-style").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'style="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x"')}break;case"vline-end":if(q.is("[x]")){v=u.find(".epos-vline-end").clone();e=q.attr("x");s=e|0;if(isNaN(s)||s<0||s>575){h.push("<"+o.tagName+">"+message.import_inattr+'x="'+e+'"');break}v.find(".attr-vline-x").val(s);e=q.attr("style");if(e){s=import_convert["line_"+e];if(s){v.find(".attr-vline-style").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'style="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x"')}break;case"page":v=u.find(".epos-page-begin").clone();$("#edit-sequence").append(v);extract(v);break;case"area":if(q.is("[x][y][width][height]")){v=u.find(".epos-area").clone();e=q.attr("x");s=e|0;if(isNaN(s)||s<0||s>575){h.push("<"+o.tagName+">"+message.import_inattr+'x="'+e+'"');break}v.find(".attr-area-x").val(s);e=q.attr("y");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y="'+e+'"');break}v.find(".attr-area-y").val(s);e=q.attr("width");s=e|0;if(isNaN(s)||s<1||s>576){h.push("<"+o.tagName+">"+message.import_inattr+'width="'+e+'"');break}v.find(".attr-area-width").val(s);e=q.attr("height");s=e|0;if(isNaN(s)||s<1||s>2400){h.push("<"+o.tagName+">"+message.import_inattr+'height="'+e+'"');break}v.find(".attr-area-height").val(s);$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x", "y", "width", "height"')}break;case"direction":if(q.is("[dir]")){v=u.find(".epos-direction").clone();e=q.attr("dir");s=import_convert["direction_"+e];if(s){v.find(".attr-direction-dir").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'dir="'+e+'"');break}$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"dir"')}break;case"position":if(q.is("[x][y]")){v=u.find(".epos-position").clone();e=q.attr("x");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'x="'+e+'"');break}v.find(".attr-position-x").val(s);e=q.attr("y");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y="'+e+'"');break}v.find(".attr-position-y").val(s);$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x", "y"')}break;case"line":if(q.is("[x1][y1][x2][y2]")){v=u.find(".epos-line").clone();e=q.attr("x1");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'x1="'+e+'"');break}v.find(".attr-line-x1").val(s);e=q.attr("y1");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y1="'+e+'"');break}v.find(".attr-line-y1").val(s);e=q.attr("x2");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'x2="'+e+'"');break}v.find(".attr-line-x2").val(s);e=q.attr("y2");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y2="'+e+'"');break}v.find(".attr-line-y2").val(s);e=q.attr("style");if(e){s=import_convert["line_"+e];if(s){v.find(".attr-line-style").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'style="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x1", "y1", "x2", "y2"')}break;case"rectangle":if(q.is("[x1][y1][x2][y2]")){v=u.find(".epos-rectangle").clone();e=q.attr("x1");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'x1="'+e+'"');break}v.find(".attr-rectangle-x1").val(s);e=q.attr("y1");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y1="'+e+'"');break}v.find(".attr-rectangle-y1").val(s);e=q.attr("x2");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'x2="'+e+'"');break}v.find(".attr-rectangle-x2").val(s);e=q.attr("y2");s=e|0;if(isNaN(s)||s<0||s>2399){h.push("<"+o.tagName+">"+message.import_inattr+'y2="'+e+'"');break}v.find(".attr-rectangle-y2").val(s);e=q.attr("style");if(e){s=import_convert["line_"+e];if(s){v.find(".attr-rectangle-style").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'style="'+e+'"');break}}$("#edit-sequence").append(v);extract(v)}else{h.push("<"+o.tagName+">"+message.import_noattr+'"x1", "y1", "x2", "y2"')}break;case"page-end":v=u.find(".epos-page-end").clone();$("#edit-sequence").append(v);extract(v);break;case"cut":v=u.find(".epos-cut").clone();e=q.attr("type");if(e){s=import_convert["cut_"+e];if(s){v.find(".attr-cut-type").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'type="'+e+'"');break}}$("#edit-sequence").append(v);extract(v);break;case"pulse":v=u.find(".epos-pulse").clone();e=q.attr("drawer");if(e){s=import_convert["drawer_"+e];if(s){v.find(".attr-pulse-drawer").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'drawer="'+e+'"');break}}e=q.attr("time");if(e){s=import_convert["pulse_"+e];if(s){v.find(".attr-pulse-time").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'time="'+e+'"');break}}$("#edit-sequence").append(v);extract(v);break;case"sound":v=u.find(".epos-sound").clone();e=q.attr("pattern");if(e){s=import_convert["pattern_"+e];if(s){v.find(".attr-sound-pattern").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'pattern="'+e+'"');break}}e=q.attr("repeat");if(e){s=e|0;if(isNaN(s)||s<0||s>255){h.push("<"+o.tagName+">"+message.import_inattr+'repeat="'+e+'"');break}v.find(".attr-sound-repeat").val(s)}e=q.attr("cycle");if(e){s=e|0;if(isNaN(s)||s<1000||s>25500){h.push("<"+o.tagName+">"+message.import_inattr+'cycle="'+e+'"');break}v.find(".attr-sound-cycle").val(s)}$("#edit-sequence").append(v);extract(v);break;case"layout":v=u.find(".epos-layout").clone();e=q.attr("type");s=import_convert["layout_"+e];if(s){v.find(".attr-layout-type").val(s)}else{h.push("<"+o.tagName+">"+message.import_inattr+'type="'+e+'"');break}e=q.attr("width");if(e){s=(e|0)/10;if(isNaN(s)||s<29||s>80){h.push("<"+o.tagName+">"+message.import_inattr+'width="'+e+'"');break}v.find(".attr-layout-width").val(s)}e=q.attr("height");if(e){s=(e|0)/10;if(isNaN(s)||(s!=0&&s<28.4)||s>310){h.push("<"+o.tagName+">"+message.import_inattr+'height="'+e+'"');break}if(s!==0){v.find(".attr-layout-height-auto:first").removeAttr("checked");v.find(".attr-layout-height-auto:last").attr("checked","checked");v.find(".attr-layout-height").val(s)}}e=q.attr("margin-top");if(e){s=(e|0)/10;if(isNaN(s)||s<-15||s>300){h.push("<"+o.tagName+">"+message.import_inattr+'margin-top="'+e+'"');break}v.find(".attr-layout-margin-top").val(s)}e=q.attr("margin-bottom");if(e){s=(e|0)/10;if(isNaN(s)||s<-1.5||s>1.5){h.push("<"+o.tagName+">"+message.import_inattr+'margin-bottom="'+e+'"');break}v.find(".attr-layout-margin-bottom").val(s)}e=q.attr("offset-cut");if(e){s=(e|0)/10;if(isNaN(s)||s<-29||s>5){h.push("<"+o.tagName+">"+message.import_inattr+'offset-cut="'+e+'"');break}v.find(".attr-layout-offset-cut").val(s)}e=q.attr("offset-label");if(e){s=(e|0)/10;if(isNaN(s)||s<0||s>1.5){h.push("<"+o.tagName+">"+message.import_inattr+'offset-label="'+e+'"');break}v.find(".attr-layout-offset-label").val(s)}$("#edit-sequence").append(v);extract(v);break;case"recovery":v=u.find(".epos-recovery").clone();$("#edit-sequence").append(v);extract(v);break;case"reset":v=u.find(".epos-reset").clone();$("#edit-sequence").append(v);extract(v);break;case"command":v=u.find(".epos-command").clone();v.find(".attr-command-data").val(decodeHex(q.text()));$("#edit-sequence").append(v);extract(v);break;default:h.push("<"+o.tagName+">"+message.import_inelem);break}});if(h.length>0){h.push("")}h.push(message.import_complete)}catch(i){h.push(i.message);h.push("");h.push(message.import_abort)}h.push("");$("#import-info").val(h.join("\n")).change()}function escapeCode(a){var b=/[\t\n\r\\]/g;if(b.test(a)){a=a.replace(b,function(f){var e="";switch(f){case"\t":e="\\t";break;case"\n":e="\\n";break;case"\r":e="\\r";break;case"\\":e="\\\\";break;default:break}return e})}return a}function decodeHex(a){var b=/[0-9A-Fa-f]{2}/g;a=a.replace(/[^0-9A-Fa-f]/g,"");a=a.slice(0,a.length&~1);if(b.test(a)){a=a.replace(b,function(e){return"\\x"+e})}return a}function decodeBase64(o){var h=String.fromCharCode,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k={},e,a,b,g,f;for(f=0;f<64;f++){k[m.charAt(f)]=f}o=o.replace(/[^A-Za-z0-9\+\/]/g,"");e=o.length;a=new Array((e+3>>2)*3);o+="AAA";f=0;g=0;while(g<e){b=k[o.charAt(g++)]<<18|k[o.charAt(g++)]<<12|k[o.charAt(g++)]<<6|k[o.charAt(g++)];a[f++]=h(b>>16&255);a[f++]=h(b>>8&255);a[f++]=h(b&255)}a.length-=(4-e%4)%4;return a.join("")}function drawMono(b,k){var a,n,h,e,m,g=0,f=0;if(b.getContext){a=b.getContext("2d");n=a.getImageData(0,0,(b.width+7)&~7,b.height);h=n.data;e=h.length>>2;while(g<e){m=(k.charCodeAt(g>>3)&(128>>(g&7)))==0?255:0;h[f++]=m;h[f++]=m;h[f++]=m;h[f++]=255;g++}a.putImageData(n,0,0)}}function drawGray16(b,m){var h=[0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,8,8,9,9,9,9,10,10,10,10,10,11,12,12,13,13,14,15,15,16,16,17,17,18,19,19,20,20,21,22,24,25,26,27,28,29,30,31,32,33,34,35,37,38,39,40,42,44,45,47,48,50,52,53,55,56,58,60,61,63,64,66,68,70,72,74,77,79,81,83,85,87,89,91,93,95,97,99,102,104,106,109,111,114,116,118,121,123,126,128,130,133,135,138,140,142,145,147,150,152,155,157,160,162,165,167,170,172,175,177,180,182,185,187,189,191,193,195,198,200,202,204,206,209,211,213,215,217,220,222,223,225,226,228,229,231,232,234,235,237,238,240,241,243,244,246,247,248,248,248,249,249,250,250,251,251,252,252,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],a,o,k,e,n,g=0,f=0;if(b.getContext){a=b.getContext("2d");o=a.getImageData(0,0,(b.width+1)&~1,b.height);k=o.data;e=k.length>>1;while(g<e){n=h[(m.charCodeAt(g>>1)&240)+8];k[f++]=n;k[f++]=n;k[f++]=n;k[f++]=255;g++;n=h[((m.charCodeAt(g>>1)&15)<<4)+8];k[f++]=n;k[f++]=n;k[f++]=n;k[f++]=255;g++}a.putImageData(o,0,0)}}var xml="";var api="";function setApiCode(){var a=new Array();a.push("var canvas = document.getElementById('canvas');");a.push("var context = canvas.getContext('2d');");a.push("var address = 'http://"+$("#setting-ipaddr").val()+"/cgi-bin/epos/service.cgi?devid="+$("#setting-devid").val()+"&timeout="+$("#setting-timeout").val()+"';");a.push("");a.push(api);a.push("");a.push("var epos = new epson.ePOSPrint(address);");a.push("epos.onreceive = function (res) { alert(res.success); };");a.push("epos.onerror = function (err) { alert(err.status); };");a.push("epos.oncoveropen = function () { alert('coveropen'); };");a.push("epos.send(builder.toString());");$("#api-code").val(a.join("\n"))}function setXmlDoc(){$("#xml-doc").val(xml)}function exportDoc(){var h=new epson.ePOSBuilder(),f=new Array(),l,n,g=modelinfo[$("#setting-model").val()],b=false,j=true,a=g.page.ini_w,k=g.page.ini_h;f.push("var builder = new epson.ePOSBuilder();");if($("#edit-force").is(":checked")){h.force=true;f.push("builder.force = true;")}try{$("#edit-sequence li").each(function(p){var m,e,o,x,q,z,y,v,u,t,s,r;l=$(this);n=p+1;if(l.hasClass("epos-text-align")){z=l.find(".attr-text-align").val();h.addTextAlign(h[z]);f.push("builder.addTextAlign(builder."+z+");")}else{if(l.hasClass("epos-text-linespc")){z=l.find(".attr-text-linespc").val()|0;h.addTextLineSpace(z);f.push("builder.addTextLineSpace("+z+");")}else{if(l.hasClass("epos-text-rotate")){z=l.find(".attr-text-rotate").is(":checked");h.addTextRotate(z);f.push("builder.addTextRotate("+z+");")}else{if(l.hasClass("epos-text-lang")){z=l.find(".attr-text-lang").val();h.addTextLang(z);f.push("builder.addTextLang('"+z+"');")}else{if(l.hasClass("epos-text-font")){z=l.find(".attr-text-font").val();h.addTextFont(h[z]);f.push("builder.addTextFont(builder."+z+");")}else{if(l.hasClass("epos-text-position")){z=l.find(".attr-text-x").val()|0;h.addTextPosition(z);f.push("builder.addTextPosition("+z+");")}else{if(l.hasClass("epos-text-vposition")){z=l.find(".attr-text-y").val()|0;h.addTextVPosition(z);f.push("builder.addTextVPosition("+z+");")}else{if(l.hasClass("epos-text-smooth")){z=l.find(".attr-text-smooth").is(":checked");h.addTextSmooth(z);f.push("builder.addTextSmooth("+z+");")}else{if(l.hasClass("epos-text-size")){z=l.find(".attr-text-width").val()|0;y=l.find(".attr-text-height").val()|0;h.addTextSize(z,y);f.push("builder.addTextSize("+z+", "+y+");")}else{if(l.hasClass("epos-text-double")){z=l.find(".attr-text-dw").is(":checked");y=l.find(".attr-text-dh").is(":checked");h.addTextDouble(z,y);f.push("builder.addTextDouble("+z+", "+y+");")}else{if(l.hasClass("epos-text-style")){z=l.find(".attr-text-reverse").is(":checked");y=l.find(".attr-text-ul").is(":checked");v=l.find(".attr-text-em").is(":checked");u=l.find(".attr-text-color").val();h.addTextStyle(z,y,v,h[u]);f.push("builder.addTextStyle("+z+", "+y+", "+v+", builder."+u+");")}else{if(l.hasClass("epos-text")){z=l.find(".attr-text-data").val();h.addText(escapeText(z));f.push("builder.addText('"+escapeTextApi(z)+"');")}else{if(l.hasClass("epos-feed-unit")){z=l.find(".attr-feed-unit").val()|0;h.addFeedUnit(z);f.push("builder.addFeedUnit("+z+");")}else{if(l.hasClass("epos-feed-line")){z=l.find(".attr-feed-line").val()|0;h.addFeedLine(z);f.push("builder.addFeedLine("+z+");")}else{if(l.hasClass("epos-feed")){h.addFeed();f.push("builder.addFeed();")}else{if(l.hasClass("epos-feed-pos")){z=l.find(".attr-feed-pos").val();h.addFeedPosition(h[z]);f.push("builder.addFeedPosition(builder."+z+");")}else{if(l.hasClass("epos-image")){z=l.find(".attr-image-color").val();y=l.find(".attr-image-mode").val();v=l.find(".attr-image-brightness").val();u=l.find(".attr-image-halftone").val();t=l.find(".attr-image-fit").is(":checked");o=l.find(".attr-image").get(0);m=$("#epos-image").get(0);if(t){x=b?(j?a:k):g.width;q=o.height*x/o.width|0}else{x=Math.min(o.width,b?(j?a:k):g.width);q=o.height}m.width=x;m.height=q;if(m.getContext){e=m.getContext("2d");e.clearRect(0,0,x,q);if(t){e.drawImage(o,0,0,x,q)}else{e.drawImage(o,0,0,x,q,0,0,x,q)}h.brightness=v;h.halftone=h[u];h.addImage(e,0,0,x,q,h[z],h[y]);f.push("builder.brightness = "+v+";");f.push("builder.halftone = builder."+u+";");f.push("builder.addImage(context, 0, 0, "+x+", "+q+", builder."+z+", builder."+y+");")}}else{if(l.hasClass("epos-logo")){z=l.find(".attr-logo-key1").val()|0;y=l.find(".attr-logo-key2").val()|0;h.addLogo(z,y);f.push("builder.addLogo("+z+", "+y+");")}else{if(l.hasClass("epos-barcode")){z=l.find(".attr-barcode-data").val();y=l.find(".attr-barcode-type").val();v=l.find(".attr-barcode-hri").val();u=l.find(".attr-barcode-font").val();t=l.find(".attr-barcode-width").val()|0;s=l.find(".attr-barcode-height").val()|0;h.addBarcode(escapeTextHex(z),h[y],h[v],h[u],t,s);f.push("builder.addBarcode('"+escapeTextHexApi(z)+"', builder."+y+", builder."+v+", builder."+u+", "+t+", "+s+");")}else{if(l.hasClass("epos-symbol")){z=l.find(".attr-symbol-data").val();y=l.find(".attr-symbol-type").val();v=l.find(".attr-symbol-level-enum").val();u=l.find(".attr-symbol-width").val()|0;t=l.find(".attr-symbol-height").val()|0;s=l.find(".attr-symbol-size").val()|0;r=l.find(".attr-symbol-level").val()|0;if(/^SYMBOL_AZTECCODE/.test(y)){h.addSymbol(escapeTextHex(z),h[y],r,u,t,s);f.push("builder.addSymbol('"+escapeTextHexApi(z)+"', builder."+y+", "+r+", "+u+", "+t+", "+s+");")}else{h.addSymbol(escapeTextHex(z),h[y],h[v],u,t,s);f.push("builder.addSymbol('"+escapeTextHexApi(z)+"', builder."+y+", builder."+v+", "+u+", "+t+", "+s+");")}}else{if(l.hasClass("epos-hline")){z=l.find(".attr-hline-x1").val()|0;y=l.find(".attr-hline-x2").val()|0;v=l.find(".attr-hline-style").val();h.addHLine(z,y,h[v]);f.push("builder.addHLine("+z+", "+y+", builder."+v+");")}else{if(l.hasClass("epos-vline-begin")){z=l.find(".attr-vline-x").val()|0;y=l.find(".attr-vline-style").val();h.addVLineBegin(z,h[y]);f.push("builder.addVLineBegin("+z+", builder."+y+");")}else{if(l.hasClass("epos-vline-end")){z=l.find(".attr-vline-x").val()|0;y=l.find(".attr-vline-style").val();h.addVLineEnd(z,h[y]);f.push("builder.addVLineEnd("+z+", builder."+y+");")}else{if(l.hasClass("epos-page-begin")){h.addPageBegin();f.push("builder.addPageBegin();");b=true;a=g.page.ini_w;k=g.page.ini_h;j=true}else{if(l.hasClass("epos-area")){z=l.find(".attr-area-x").val()|0;y=l.find(".attr-area-y").val()|0;v=l.find(".attr-area-width").val()|0;u=l.find(".attr-area-height").val()|0;h.addPageArea(z,y,v,u);f.push("builder.addPageArea("+z+", "+y+", "+v+", "+u+");");a=v;k=u}else{if(l.hasClass("epos-direction")){z=l.find(".attr-direction-dir").val();h.addPageDirection(h[z]);f.push("builder.addPageDirection(builder."+z+");");j=dir_convert[h[z]].w}else{if(l.hasClass("epos-position")){z=l.find(".attr-position-x").val()|0;y=l.find(".attr-position-y").val()|0;h.addPagePosition(z,y);f.push("builder.addPagePosition("+z+", "+y+");")}else{if(l.hasClass("epos-line")){z=l.find(".attr-line-x1").val()|0;y=l.find(".attr-line-y1").val()|0;v=l.find(".attr-line-x2").val()|0;u=l.find(".attr-line-y2").val()|0;t=l.find(".attr-line-style").val();h.addPageLine(z,y,v,u,h[t]);f.push("builder.addPageLine("+z+", "+y+", "+v+", "+u+", builder."+t+");")}else{if(l.hasClass("epos-rectangle")){z=l.find(".attr-rectangle-x1").val()|0;y=l.find(".attr-rectangle-y1").val()|0;v=l.find(".attr-rectangle-x2").val()|0;u=l.find(".attr-rectangle-y2").val()|0;t=l.find(".attr-rectangle-style").val();h.addPageRectangle(z,y,v,u,h[t]);f.push("builder.addPageRectangle("+z+", "+y+", "+v+", "+u+", builder."+t+");")}else{if(l.hasClass("epos-page-end")){h.addPageEnd();f.push("builder.addPageEnd();");b=false}else{if(l.hasClass("epos-cut")){z=l.find(".attr-cut-type").val();h.addCut(h[z]);f.push("builder.addCut(builder."+z+");")}else{if(l.hasClass("epos-pulse")){z=l.find(".attr-pulse-drawer").val();y=l.find(".attr-pulse-time").val();h.addPulse(h[z],h[y]);f.push("builder.addPulse(builder."+z+", builder."+y+");")}else{if(l.hasClass("epos-sound")){z=l.find(".attr-sound-pattern").val();y=l.find(".attr-sound-repeat").val()|0;v=l.find(".attr-sound-cycle").val()|0;if(/^PATTERN_(10|[1-9])$/.test(z)){h.addSound(h[z],y,v);f.push("builder.addSound(builder."+z+", "+y+", "+v+");")}else{h.addSound(h[z],y);f.push("builder.addSound(builder."+z+", "+y+");")}}else{if(l.hasClass("epos-layout")){z=l.find(".attr-layout-type").val();y=l.find(".attr-layout-width").val()*10|0;v=l.find(".attr-layout-height-auto:first").is(":checked")?0:l.find(".attr-layout-height").val()*10|0;u=l.find(".attr-layout-margin-top").val()*10|0;t=l.find(".attr-layout-margin-bottom").val()*10|0;s=l.find(".attr-layout-offset-cut").val()*10|0;r=l.find(".attr-layout-offset-label").val()*10|0;h.addLayout(h[z],y,v,u,t,s,r);f.push("builder.addLayout(builder."+z+", "+y+", "+v+", "+u+", "+t+", "+s+", "+r+");")}else{if(l.hasClass("epos-recovery")){h.addRecovery();f.push("builder.addRecovery();")}else{if(l.hasClass("epos-reset")){h.addReset();f.push("builder.addReset();")}else{if(l.hasClass("epos-command")){z=l.find(".attr-command-data").val();h.addCommand(escapeTextHex(z));f.push("builder.addCommand('"+escapeTextHexApi(z)+"');")}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}});xml=h.toString().replace(/><(?!\/(text|barcode|symbol|command)>)/g,">\n<");api=f.join("\n")}catch(i){throw new Error("["+message.line+" "+n+"] "+i)}}function escapeTextHex(a){var b=/\\x[0-9A-Fa-f]{2}/g;if(b.test(a)){a=a.replace(b,function(e){return String.fromCharCode(parseInt(e.slice(2),16))})}return escapeText(a)}function escapeText(a){var b=/\\[tnr\\]|\\/g;if(b.test(a)){a=a.replace(b,function(f){var e="";switch(f){case"\\t":e="\x09";break;case"\\n":e="\x0a";break;case"\\r":e="\x0d";break;case"\\\\":e="\\";break;default:break}return e})}return a}function escapeTextHexApi(a){var b=/\\x[0-9A-Fa-f]{2}|\\[tnr\\]|['"]|\\/g;if(b.test(a)){a=a.replace(b,function(f){var e=f;switch(f){case'"':e='\\"';break;case"'":e="\\'";break;case"\\":e="";break;default:break}return e})}return a}function escapeTextApi(a){var b=/\\[tnr\\]|['"]|\\/g;if(b.test(a)){a=a.replace(b,function(f){var e=f;switch(f){case'"':e='\\"';break;case"'":e="\\'";break;case"\\":e="";break;default:break}return e})}return a}var color_convert={none:"#ffffff",color_1:"#000000",color_2:"#c00000",color_3:"#00c000",color_4:"#0000c0"};var line_convert={thin:{w:1,d:false},medium:{w:2,d:false},thick:{w:4,d:false},thin_double:{w:1,d:true},medium_double:{w:2,d:true},thick_double:{w:4,d:true}};var dir_convert={left_to_right:{x:0,y:0,r:0,w:true},top_to_bottom:{x:1,y:0,r:Math.PI*0.5000001,w:false},right_to_left:{x:1,y:1,r:Math.PI,w:true},bottom_to_top:{x:0,y:1,r:Math.PI*1.5000001,w:false}};var model=modelinfo.tm_t88_80;var align="left";var linespc=30;var rotate=false;var line_x=0;var line_y=191;var line_w=0;var line_h=0;var text_l="en";var text_f="font_a";var text_s=false;var text_w=1;var text_h=1;var text_r=false;var text_u=false;var text_e=false;var text_c=color_convert.color_1;var font_a=24;var font_k=24;var hline=[];var vline=[];var page=false;var page_linespc=30;var page_h=0;var area_x=0;var area_y=0;var area_w=512;var area_h=831;var area_valid=false;var page_dir=dir_convert.left_to_right;var page_x=0;var page_y=23;function drawPreview(){var a=new epson.ePOSBuilder(),b,e;model=modelinfo[$("#setting-model").val()];align="left";linespc=model.linespc;rotate=false;line_x=0;line_y=191;line_w=0;line_h=0;text_l="en";text_f="font_a";text_s=false;text_w=1;text_h=1;text_r=false;text_u=false;text_e=false;text_c=color_convert.color_1;font_a=24;font_k=24;hline=[];vline=[];page=false;page_linespc=model.linespc;b=$("#preview-text").get(0);if(b.getContext){e=b.getContext("2d");e.clearRect(0,0,b.width,b.height)}$("#preview-paper canvas").remove();$("#preview-paper").width(model.width);$("#preview-width span").text(model.width);$("#preview-width img:eq(1)").attr("width",model.width-2);$("#edit-sequence li").each(function(){var n=$(this),g,f,h,m,l,k,j,i;if(n.hasClass("epos-text-align")){m=a[n.find(".attr-text-align").val()];if(page){align=m}else{if(line_w==0&&line_x==0){align=m}}}else{if(n.hasClass("epos-text-linespc")){m=n.find(".attr-text-linespc").val()-0;if(page){page_linespc=m}else{linespc=m}}else{if(n.hasClass("epos-text-rotate")){m=n.find(".attr-text-rotate").is(":checked");if(page){rotate=m}else{if(line_w==0&&line_x==0){rotate=m}}}else{if(n.hasClass("epos-text-lang")){text_l=n.find(".attr-text-lang").val()}else{if(n.hasClass("epos-text-font")){text_f=a[n.find(".attr-text-font").val()]}else{if(n.hasClass("epos-text-position")){m=n.find(".attr-text-x").val()-0;if(page){if(m<(page_dir.w?area_w:area_h)){page_x=m}}else{if(m<model.width){line_x=m}}}else{if(n.hasClass("epos-text-vposition")){m=n.find(".attr-text-y").val()-0;if(page){if(m<(page_dir.w?area_h:area_w)){page_y=m}}else{}}else{if(n.hasClass("epos-text-smooth")){text_s=n.find(".attr-text-smooth").is(":checked")}else{if(n.hasClass("epos-text-size")){text_w=n.find(".attr-text-width").val()-0;text_h=n.find(".attr-text-height").val()-0}else{if(n.hasClass("epos-text-double")){text_w=n.find(".attr-text-dw").is(":checked")?2:1;text_h=n.find(".attr-text-dh").is(":checked")?2:1}else{if(n.hasClass("epos-text-style")){text_r=n.find(".attr-text-reverse").is(":checked");text_u=n.find(".attr-text-ul").is(":checked");text_e=n.find(".attr-text-em").is(":checked");text_c=color_convert[a[n.find(".attr-text-color").val()]]}else{if(n.hasClass("epos-text")){m=escapeText(n.find(".attr-text-data").val());if(page){drawPageText(m)}else{drawText(m)}}else{if(n.hasClass("epos-feed-unit")){m=n.find(".attr-feed-unit").val()-0;if(page){drawPageFeed(m)}else{drawFeed(m)}}else{if(n.hasClass("epos-feed-line")){m=n.find(".attr-feed-line").val()-0;if(page){drawPageFeed(m*page_linespc)}else{drawFeed(m*linespc)}}else{if(n.hasClass("epos-feed")){if(page){drawPageFeed(page_linespc)}else{drawFeed(linespc)}}else{if(n.hasClass("epos-feed-pos")){m=a[n.find(".attr-feed-pos").val()];if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(n.find("img").get(0),m)}}else{if(n.hasClass("epos-image")){m=a[n.find(".attr-image-color").val()];l=a[n.find(".attr-image-mode").val()];k=n.find(".attr-image-brightness").val()-0;j=a[n.find(".attr-image-halftone").val()];i=n.find(".attr-image-fit").is(":checked");h=n.find(".attr-image").get(0);if(page){drawPageImage(h,m,l,k,j,i)}else{if(line_w==0){drawImage(h,m,l,k,j,i)}}}else{if(n.hasClass("epos-logo")){m=n.find(".attr-logo-key1").val()-0;l=n.find(".attr-logo-key2").val()-0;if(page){drawPageIcon(n.find("img").get(0),m+", "+l,false)}else{if(line_w==0){drawIcon(n.find("img").get(0),m+", "+l)}}}else{if(n.hasClass("epos-barcode")){m=n.find(".attr-barcode-data").val();l=a[n.find(".attr-barcode-type").val()];if(page){drawPageIcon(n.find("img").get(0),l+", "+m,false)}else{if(line_w==0){drawIcon(n.find("img").get(0),l+", "+m)}}}else{if(n.hasClass("epos-symbol")){m=n.find(".attr-symbol-data").val();l=a[n.find(".attr-symbol-type").val()];if(page){drawPageIcon(n.find("img").get(0),l+", "+m,true)}else{if(line_w==0){drawIcon(n.find("img").get(0),l+", "+m)}}}else{if(n.hasClass("epos-hline")){m=n.find(".attr-hline-x1").val()-0;l=n.find(".attr-hline-x2").val()-0;k=a[n.find(".attr-hline-style").val()];if(page){}else{hline.push({x1:Math.min(m,l),x2:Math.max(m,l),style:k})}}else{if(n.hasClass("epos-vline-begin")){m=n.find(".attr-vline-x").val()-0;l=a[n.find(".attr-vline-style").val()];if(page){}else{vline[l+m]={x:m,style:l}}}else{if(n.hasClass("epos-vline-end")){m=n.find(".attr-vline-x").val()-0;l=a[n.find(".attr-vline-style").val()];if(page){}else{delete vline[l+m]}}else{if(n.hasClass("epos-page-begin")){if(page){}else{if(line_w==0&&line_x==0){g=$("#preview-page").get(0);if(g.getContext){f=g.getContext("2d");f.clearRect(0,0,g.width,g.height)}g=$("#preview-area").get(0);if(g.getContext){f=g.getContext("2d");f.clearRect(0,0,g.width,g.height)}page=true;page_h=0;area_x=0;area_y=0;area_w=model.page.ini_w;area_h=model.page.ini_h;area_valid=false;page_dir=dir_convert.left_to_right;page_x=0;page_y=23;vline=[]}}}else{if(n.hasClass("epos-area")){m=n.find(".attr-area-x").val()-0;l=n.find(".attr-area-y").val()-0;k=n.find(".attr-area-width").val()-0;j=n.find(".attr-area-height").val()-0;if(page){moveAreaToPage();area_x=m;area_y=l;area_w=k;area_h=j;area_valid=true;page_x=0;page_y=23}else{}}else{if(n.hasClass("epos-direction")){m=a[n.find(".attr-direction-dir").val()];if(page){page_dir=dir_convert[m];page_x=0;page_y=23}else{}}else{if(n.hasClass("epos-position")){m=n.find(".attr-position-x").val()-0;l=n.find(".attr-position-y").val()-0;if(page){if(m<(page_dir.w?area_w:area_h)){page_x=m}if(l<(page_dir.w?area_h:area_w)){page_y=l}}else{}}else{if(n.hasClass("epos-line")){m=n.find(".attr-line-x1").val()-0;l=n.find(".attr-line-y1").val()-0;k=n.find(".attr-line-x2").val()-0;j=n.find(".attr-line-y2").val()-0;i=a[n.find(".attr-line-style").val()];if(page){drawPageLine(Math.min(m,k),Math.min(l,j),Math.max(m,k),Math.max(l,j),line_convert[i])}else{}}else{if(n.hasClass("epos-rectangle")){m=n.find(".attr-rectangle-x1").val()-0;l=n.find(".attr-rectangle-y1").val()-0;k=n.find(".attr-rectangle-x2").val()-0;j=n.find(".attr-rectangle-y2").val()-0;i=a[n.find(".attr-rectangle-style").val()];if(page){drawPageRect(Math.min(m,k),Math.min(l,j),Math.max(m,k),Math.max(l,j),line_convert[i])}else{}}else{if(n.hasClass("epos-page-end")){if(page){moveAreaToPage();drawPage();page=false}else{}}else{if(n.hasClass("epos-cut")){m=a[n.find(".attr-cut-type").val()];if(page){}else{if(line_w==0&&line_x==0){drawFixedIcon(n.find("img").get(0),m)}}}else{if(n.hasClass("epos-pulse")){m=a[n.find(".attr-pulse-drawer").val()];l=a[n.find(".attr-pulse-time").val()];if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(n.find("img").get(0),m+", "+l)}}else{if(n.hasClass("epos-sound")){m=a[n.find(".attr-sound-pattern").val()];l=n.find(".attr-sound-repeat").val()-0;if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(n.find("img").get(0),m+", "+l)}}else{if(n.hasClass("epos-layout")){m=a[n.find(".attr-layout-type").val()];if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(n.find("img").get(0),m)}}else{if(n.hasClass("epos-recovery")){if(page){}else{drawFixedIcon(n.find("img").get(0),"")}}else{if(n.hasClass("epos-reset")){if(page){}else{drawFixedIcon(n.find("img").get(0),"")}}else{if(n.hasClass("epos-command")){m=n.find(".attr-command-data").val();if(page){drawPageIcon(n.find("img").get(0),m)}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(n.find("img").get(0),m,false)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}});if(hline.length>0){drawHLine()}}function drawText(h){var a,f,g,e,b;if(hline.length>0){drawHLine()}a=$("#preview-text").get(0);if(a.getContext){f=a.getContext("2d");f.textAlign="left";f.textBaseline="alphabetic";for(e=0;e<h.length;e++){g=h.charAt(e);switch(g){case"\t":if(line_x==model.width){drawFeed(linespc)}b=font_a*4;line_x=Math.floor(line_x/b)*b+b;if(line_x>model.width){drawFeed(linespc)}break;case"\n":drawFeed(linespc);break;case"\r":break;default:drawChar(f,g);break}}}}function drawChar(e,g){var a,i,b,f;e.font="24px "+font;if(e.measureText(g).width<18){f=model.ank[text_f];if(f==0){f=font_a}else{font_a=f}b=f/2}else{f=model.kanji[text_f];if(f==0){f=font_k}else{font_k=f}b=f}e.font=(f-2)+"px "+font;if(line_x+b*text_w>model.width){drawFeed(linespc)}line_h=Math.max(line_h,f*text_h);a=line_x/text_w;i=line_y/text_h;e.fillStyle=text_c;e.strokeStyle=text_c;e.shadowColor=text_c;e.setTransform(text_w,0,0,text_h,0,0);if(rotate){e.translate(576/text_w,192/text_h);e.rotate(Math.PI)}if(text_r){e.fillRect(a,i,b,-f);c="#f0f0f0";e.fillStyle=c;e.strokeStyle=c;e.shadowColor=c}if(b==f&&text_l=="en"){e.strokeRect(a+2,i-2,b-4,4-f)}else{e.shadowBlur=text_s?2:0;e.fillText(g,a,i-4);if(text_e){e.fillText(g,a+1,i-4)}e.shadowBlur=0}if(text_u){e.fillRect(a,i-1,b,1)}e.setTransform(1,0,0,1,0,0);line_x+=b*text_w;line_w=Math.max(line_w,line_x)}function drawFeed(k){var f,e,m,b,j=0,h,g,a;if(hline.length>0){drawHLine()}f=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:Math.max(line_h,k)}).get(0);m=$("#preview-text").get(0);if(f.getContext&&m.getContext){e=f.getContext("2d");b=m.getContext("2d");if(line_w>0){if(rotate){if(align!="right"){j=(model.width-line_w)/(align=="left"?1:2)}e.drawImage(m,576-line_w,0,line_w,line_h,j,0,line_w,line_h)}else{if(align!="left"){j=(model.width-line_w)/(align=="right"?1:2)}e.drawImage(m,0,192-line_h,line_w,line_h,j,0,line_w,line_h)}}e.fillStyle="#000000";for(h in vline){g=vline[h];a=line_convert[g.style];e.fillRect(g.x,0,a.w,f.height);if(a.d){e.fillRect(g.x+a.w+1,0,a.w,f.height)}}b.clearRect(0,0,m.width,m.height)}$("#preview-paper").append(f);line_x=0;line_w=0;line_h=0}function drawHLine(){var b,g,f,j,e,a,h;if(line_w>0){hline=[];drawFeed(0)}else{f=$("#preview-text").get(0);if(f.getContext){j=f.getContext("2d");j.fillStyle="#000000";for(e=0;e<hline.length;e++){a=hline[e];h=line_convert[a.style];j.fillRect(a.x1,0,a.x2-a.x1,h.w);if(h.d){j.fillRect(a.x1,h.w+1,a.x2-a.x1,h.w)}line_h=Math.max(line_h,h.d?h.w*2+1:h.w)}b=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:line_h}).get(0);if(b.getContext){g=b.getContext("2d");g.drawImage(f,0,0,model.width,line_h,0,0,model.width,line_h);g.fillStyle="#000000";for(e in vline){a=vline[e];h=line_convert[a.style];g.fillRect(a.x,0,h.w,b.height);if(h.d){g.fillRect(a.x+h.w+1,0,h.w,b.height)}}j.clearRect(0,0,f.width,f.height)}}$("#preview-paper").append(b);hline=[];line_x=0;line_w=0;line_h=0}}function drawIcon(j,k){var e,g,a=0,f,b,h;if(hline.length>0){drawHLine()}e=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:48}).get(0);if(e.getContext){g=e.getContext("2d");g.fillStyle="#000000";for(f in vline){b=vline[f];h=line_convert[b.style];g.fillRect(b.x,0,h.w,e.height);if(h.d){g.fillRect(b.x+h.w+1,0,h.w,e.height)}}if(rotate){g.translate(model.width,48);g.rotate(Math.PI)}if(align!="left"){a=(model.width-40)/(align=="right"?1:2)}g.shadowBlur=4;g.shadowColor="#000000";g.drawImage(j,a+4,8);g.shadowBlur=1;g.font="12px sans-serif";g.textBaseline="middle";if(align=="right"){g.textAlign="right";g.fillText(k,a-4,24)}else{g.textAlign="left";g.fillText(k,a+44,24)}g.shadowBlur=0;g.setTransform(1,0,0,1,0,0)}$("#preview-paper").append(e);line_x=0;line_w=0;line_h=0}function drawFixedIcon(e,f){var a,b;if(hline.length>0){drawHLine()}a=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:48}).get(0);if(a.getContext){b=a.getContext("2d");b.shadowBlur=4;b.shadowColor="#000000";b.drawImage(e,4,8);b.shadowBlur=1;b.font="12px sans-serif";b.textBaseline="middle";b.textAlign="left";b.fillText(f,44,24);b.shadowBlur=0}$("#preview-paper").append(a)}function drawImage(g,j,n,t,r,o){var e,b,q,s,m,p=0,k,f,a;if(hline.length>0){drawHLine()}if(o){s=model.width;m=g.height*s/g.width|0}else{s=Math.min(g.width,model.width);m=g.height}e=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:m}).get(0);if(e.getContext){b=e.getContext("2d");if(align!="left"&&model.width>s){p=(model.width-s)/(align=="right"?1:2)}if(o){b.drawImage(g,p,0,s,m)}else{b.drawImage(g,0,0,s,m,p,0,s,m)}q=b.getImageData(p,0,s,m);if(n=="gray16"){toGrayImage(q,t)}else{toMonoImage(q,r,t,color_convert[j])}b.putImageData(q,p,0);for(k in vline){f=vline[k];a=line_convert[f.style];b.fillRect(f.x,0,a.w,e.height);if(a.d){b.fillRect(f.x+a.w+1,0,a.w,e.height)}}}$("#preview-paper").append(e);line_x=0;line_w=0;line_h=0}function drawPageText(h){var a,f,g,e,b;if(hline.length>0){drawHLine()}a=$("#preview-area").get(0);if(a.getContext){f=a.getContext("2d");f.textAlign="left";f.textBaseline="alphabetic"}for(e=0;e<h.length;e++){g=h.charAt(e);switch(g){case"\t":if(page_x==(page_dir.w?area_w:area_h)){drawPageFeed(page_linespc)}b=font_a*4;page_x=Math.floor(page_x/b)*b+b;if(page_x>(page_dir.w?area_w:area_h)){drawPageFeed(page_linespc)}break;case"\n":drawPageFeed(page_linespc);break;case"\r":break;default:drawPageChar(f,g);break}}}function drawPageChar(e,g){var a,i,b,f;e.font="24px "+font;if(e.measureText(g).width<18){f=model.ank[text_f];if(f==0){f=font_a}else{font_a=f}b=f/2}else{f=model.kanji[text_f];if(f==0){f=font_k}else{font_k=f}b=f}e.font=(f-2)+"px "+font;if(page_x+b*text_w>(page_dir.w?area_w:area_h)){drawPageFeed(page_linespc)}a=page_x/text_w;i=page_y/text_h;e.fillStyle=text_c;e.strokeStyle=text_c;e.shadowColor=text_c;if(page_dir.w){e.setTransform(text_w,0,0,text_h,0,0);e.translate(page_dir.x*area_w/text_w,page_dir.y*area_h/text_h);e.rotate(page_dir.r)}else{e.setTransform(text_h,0,0,text_w,0,0);e.translate(page_dir.x*area_w/text_h,page_dir.y*area_h/text_w);e.rotate(page_dir.r)}if(text_r){e.fillRect(a,i,b,-f);c="#f0f0f0";e.fillStyle=c;e.strokeStyle=c;e.shadowColor=c}if(b==f&&text_l=="en"){e.strokeRect(a+2,i-2,b-4,4-f)}else{e.shadowBlur=text_s?2:0;e.fillText(g,a,i-4);if(text_e){e.fillText(g,a+1,i-4)}e.shadowBlur=0}if(text_u){e.fillRect(a,i-1,b,1)}e.setTransform(1,0,0,1,0,0);page_x+=b*text_w;area_valid=true}function drawPageFeed(a){page_x=0;page_y+=a}function drawPageIcon(e,f,g){var a,b;a=$("#preview-area").get(0);if(a.getContext){b=a.getContext("2d");b.translate(page_dir.x*area_w,page_dir.y*area_h);b.rotate(page_dir.r);b.shadowBlur=4;b.shadowColor="#000000";b.drawImage(e,page_x+4,page_y+(g?8:-39));b.shadowBlur=1;b.font="12px sans-serif";b.textBaseline="middle";b.textAlign="left";b.fillText(f,page_x+44,page_y+(g?24:-23));b.shadowBlur=0;b.setTransform(1,0,0,1,0,0)}page_x+=48;area_valid=true}function drawPageImage(e,f,i,p,m,j){var b,a,k,o,l,n,g;b=$("#epos-image").get(0);if(j){n=page_dir.w?area_w:area_h;g=e.height*n/e.width|0}else{n=Math.min(e.width,page_dir.w?area_w:area_h);g=e.height}b.width=n;b.height=g;if(i!="gray16"){k=$("#preview-area").get(0);if(b.getContext&&k.getContext){a=b.getContext("2d");o=k.getContext("2d");a.clearRect(0,0,n,g);if(j){a.drawImage(e,0,0,n,g)}else{a.drawImage(e,0,0,n,g,0,0,n,g)}l=a.getImageData(0,0,n,g);toMonoImage(l,m,p,color_convert[f]);a.putImageData(l,0,0);o.translate(page_dir.x*area_w,page_dir.y*area_h);o.rotate(page_dir.r);o.drawImage(b,page_x,page_y-g+1);o.setTransform(1,0,0,1,0,0)}area_valid=true}}function drawPageLine(e,i,a,g,h){var b,f;b=$("#preview-area").get(0);if(b.getContext){f=b.getContext("2d");f.translate(page_dir.x*area_w,page_dir.y*area_h);f.rotate(page_dir.r);f.fillStyle="#000000";if(i==g){f.fillRect(e,i,a-e,h.w);if(h.d){f.fillRect(e,i+h.w+1,a-e,h.w)}}else{if(e==a){f.fillRect(e,i,h.w,g-i);if(h.d){f.fillRect(e+h.w+1,i,h.w,g-i)}}}f.setTransform(1,0,0,1,0,0)}area_valid=true}function drawPageRect(e,i,a,g,h){var b,f;b=$("#preview-area").get(0);if(b.getContext){f=b.getContext("2d");f.translate(page_dir.x*area_w,page_dir.y*area_h);f.rotate(page_dir.r);f.fillStyle="#000000";f.fillRect(e,i,a-e,h.w);f.fillRect(e,i,h.w,g-i);f.fillRect(a,g,e-a,-h.w);f.fillRect(a,g,-h.w,i-g);if(h.d){d=h.w+1;f.fillRect(e+d,i+d,a-e-d-d,h.w);f.fillRect(e+d,i+d,h.w,g-i-d-d);f.fillRect(a-d,g-d,e-a+d+d,-h.w);f.fillRect(a-d,g-d,-h.w,i-g+d+d)}f.setTransform(1,0,0,1,0,0)}area_valid=true}function moveAreaToPage(){var b=$("#preview-area").get(0),f=$("#preview-page").get(0),e,a;if(area_valid){if(b.getContext&&f.getContext){e=b.getContext("2d");a=f.getContext("2d");a.drawImage(b,0,0,area_w,area_h,area_x,area_y,area_w,area_h);e.clearRect(0,0,b.width,b.height)}page_h=Math.max(page_h,area_y+area_h)}}function drawPage(){var e,b,n,f,k,j,g,a,m;k=Math.min(page_h,model.page.max_h);if(k==0){k=model.page.ini_h}e=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:k}).get(0);n=$("#preview-page").get(0);if(e.getContext&&n.getContext){b=e.getContext("2d");f=n.getContext("2d");b.drawImage(n,0,0,model.width,k,0,0,model.width,k);f.clearRect(0,0,n.width,n.height)}$("#preview-paper").append(e)}function toMonoImage(D,z,I,M){var m=String.fromCharCode,O=[[2,130,34,162,10,138,42,170],[194,66,226,98,202,74,234,106],[50,178,18,146,58,186,26,154],[242,114,210,82,250,122,218,90],[14,142,46,174,6,134,38,166],[206,78,238,110,198,70,230,102],[62,190,30,158,54,182,22,150],[254,126,222,94,246,118,214,86]],L=D.data,o=D.width,H=D.height,a=parseInt(M.slice(1,3),16),u=parseInt(M.slice(3,5),16),B=parseInt(M.slice(5,7),16),E=0,C=0,A=0,y=128,K=new Array(),l,k,N,r,J,G,F;if(z==1){G=o;while(G--){K.push(0)}}for(F=0;F<H;F++){l=0;k=0;G=0;while(G<o){N=G&7;if(z==0){y=O[F&7][N]}r=Math.pow(((L[C++]*0.29891+L[C++]*0.58661+L[C++]*0.11448)*L[C]/255+255-L[C++])/255,1/I)*255|0;if(z==1){r+=K[G]+l>>4;J=r-(r<y?0:255);if(G>0){K[G-1]+=J}K[G]=J*7+k;l=J*5;k=J*3}E=r<y?0:255;L[A++]=Math.max(E,a);L[A++]=Math.max(E,u);L[A++]=Math.max(E,B);L[A++]=255-E;G++}}}function toGrayImage(t,o){var u=String.fromCharCode,A=[[0,9,2,11],[13,4,15,6],[3,12,1,10],[16,7,14,5]],r=t.data,z=t.width,m=t.height,f=0,e=0,a=0,s,B,y,l,k;for(k=0;k<m;k++){l=0;while(l<z){s=l&1;B=Math.pow(((r[e++]*0.29891+r[e++]*0.58661+r[e++]*0.11448)*r[e]/255+255-r[e++])/255,1/o)*255|0;y=B/17|0;if(A[k&3][l&3]<B%17){y++}f=y<<4;r[a++]=f;r[a++]=f;r[a++]=f;r[a++]=255;l++}}}var epos=new epson.ePOSPrint();epos.onreceive=function(a){if(a.printjobid.length>0){addPrintInfo((a.success?message.success+" (":message.failure+" ("+message.epos_code+": "+a.code+", ")+message.epos_jobid+": "+a.printjobid+")")}else{addPrintInfo(a.success?message.success:message.failure+" ("+message.epos_code+": "+a.code+")")}};epos.onerror=function(a){addPrintInfo(message.epos_error+" ("+message.epos_status+": "+a.status+")")};epos.ononline=function(){addPrintInfo(message.epos_online)};epos.onoffline=function(){addPrintInfo(message.epos_offline)};epos.onpoweroff=function(){addPrintInfo(message.epos_poweroff)};epos.oncoverok=function(){addPrintInfo(message.epos_coverok)};epos.oncoveropen=function(){addPrintInfo(message.epos_coveropen)};epos.onpaperok=function(){addPrintInfo(message.epos_paperok)};epos.onpapernearend=function(){addPrintInfo(message.epos_papernearend)};epos.onpaperend=function(){addPrintInfo(message.epos_paperend)};epos.ondrawerclosed=function(){addPrintInfo(message.epos_drawerclosed)};epos.ondraweropen=function(){addPrintInfo(message.epos_draweropen)};epos.onbatterylow=function(){addPrintInfo(message.epos_batterylow)};epos.onbatteryok=function(){addPrintInfo(message.epos_batteryok)};epos.onbatterystatuschange=function(a){if(a>0){addPrintInfo(message.epos_batterystatus+": 0x"+("000"+a.toString(16)).slice(-4))}};function setPrintDoc(){$("#print-doc").val(xml)}function sendPrintDoc(){var a,b;if($("#setting-jobid").is(":checked")){a=new Date();b="E"+a.getHours()+("0"+a.getMinutes()).slice(-2)+("0"+a.getSeconds()).slice(-2)+("00"+a.getMilliseconds()).slice(-3);epos.send($("#print-doc").val(),b);addPrintInfo(message.epos_send+" ("+message.epos_jobid+": "+b+")")}else{epos.send($("#print-doc").val());addPrintInfo(message.epos_send)}}function setStatusMonitor(){epos.address="http://"+$("#setting-ipaddr").val()+"/cgi-bin/epos/service.cgi?devid="+$("#setting-devid").val()+"&timeout="+$("#setting-timeout").val();if($("#setting-status").is(":checked")){if(!epos.enabled){epos.open();addPrintInfo(message.epos_open)}}else{if(epos.enabled){epos.close();addPrintInfo(message.epos_close)}}}function addPrintInfo(f){var b=new Date(),a=[b.getFullYear(),("0"+(b.getMonth()+1)).slice(-2),("0"+b.getDate()).slice(-2)].join("-"),e=[b.getHours(),("0"+b.getMinutes()).slice(-2),("0"+b.getSeconds()).slice(-2)].join(":");$("#print-info").val($("#print-info").val()+a+" "+e+" "+f+"\n").change()};